@model IEnumerable<Blog>
@using System.Text.RegularExpressions
@{
    ViewData["Title"] = "Blog/Haber";
    Layout = "_PublicLayout";
}

<!-- Blog Header Section -->
<section class="blog-header-section">
    <div class="container blog-header-container">
        <!-- Blog Başlık -->
        <h1 class="blog-main-title">Blog/Haber</h1>
        <p class="blog-subtitle">
            Lojistik dünyasındaki en güncel trendler, sektörel analizler ve
            uzman görüşleriyle işinizi ileriye taşıyacak içerikler burada
        </p>

        <!-- Kategori Tabları - Scroll İpuçları ile -->
        <div class="blog-category-wrapper">
            <div class="blog-category-tabs" id="categoryTabs">
                <!-- Global Tab -->
                <a href="@Url.Action("Index", "PublicBlog")"
                   class="category-tab @(ViewBag.CurrentTag == null ? "active" : "")">
                    Global
                </a>

                <!-- Dinamik Tag'ler -->
                @if (ViewBag.AvailableTags != null)
                {
                    @foreach (var tag in ViewBag.AvailableTags)
                    {
                        var tagObj = (dynamic)tag;
                        <a href="@Url.Action("Tag", "PublicBlog", new { tag = tagObj.Name })"
                           class="category-tab @(ViewBag.CurrentTag?.ToString() == tagObj.Name?.ToString() ? "active" : "")">
                            @tagObj.Name
                        </a>
                    }
                }
            </div>

            <!-- Scroll İpucu -->
            <div class="scroll-hint" id="scrollHint">
                <i class="fas fa-hand-point-left"></i>
                Kaydırmak için sürükleyin veya mouse tekerleğini kullanın
                <i class="fas fa-hand-point-right"></i>
            </div>
        </div>
    </div>
</section>

<!-- Blog Content Section -->
<section class="blog-content-section">
    <div class="container">
        <div class="row">
            <!-- Blog Posts -->
            <div class="col-lg-8">
                <!-- Filter Alerts -->
                @if (ViewBag.CurrentTag != null)
                {
                    <div class="blog-alert alert-primary">
                        <div>
                            <i class="fas fa-tag me-2"></i>
                            <strong>Kategori:</strong> @ViewBag.CurrentTag
                        </div>
                        <a href="@Url.Action("Index", "PublicBlog")" class="close-filter">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                }

                @if (ViewBag.SearchQuery != null)
                {
                    <div class="blog-alert alert-info">
                        <div>
                            <i class="fas fa-search me-2"></i>
                            <strong>Arama:</strong> "@ViewBag.SearchQuery"
                            <span class="ms-2 text-muted">(@Model.Count() sonuç)</span>
                        </div>
                        <a href="@Url.Action("Index", "PublicBlog")" class="close-filter">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                }

                <!-- Blog Cards Grid -->
                @if (!Model.Any())
                {
                    <div class="blog-empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Henüz İçerik Bulunmuyor</h3>
                        <p>Bu kategoride henüz blog yazısı bulunmamaktadır.</p>
                    </div>
                }
                else
                {
                    <div class="blog-grid">
                        @foreach (var blog in Model)
                        {
                            <article class="blog-card">
                                <!-- Blog Image -->
                                <div class="blog-card-image">
                                    <div class="blog-card-img" style="background-image: url('@(!string.IsNullOrEmpty(blog.ImageUrl) ? "/uploads/" + blog.ImageUrl : "/img/blog-placeholder.png")')"></div>
                                </div>

                                <!-- Blog Content -->
                                <div class="blog-card-content">
                                    <!-- Meta Information -->
                                    <div class="blog-card-meta">
                                        <div class="blog-meta-item">
                                            <i class="far fa-calendar-alt"></i>
                                            <span>@blog.PublishDate.ToString("dd MMM yyyy")</span>
                                        </div>
                                        <div class="blog-meta-item">
                                            <i class="far fa-eye"></i>
                                            <span>@blog.ViewCount görüntülenme</span>
                                        </div>
                                    </div>

                                    <!-- Blog Title -->
                                    <h2 class="blog-card-title">@blog.Title</h2>

                                    <!-- Blog Excerpt -->
                                    @{
                                        var plainText = Regex.Replace(blog.Content, "<.*?>", "");
                                        var excerpt = plainText.Length > 160 ? plainText.Substring(0, 160) + "..." : plainText;
                                    }
                                    <p class="blog-card-excerpt">@excerpt</p>

                                    <!-- Blog Tags -->
                                    @if (!string.IsNullOrEmpty(blog.Tags))
                                    {
                                        <div class="blog-card-tags">
                                            @foreach (var tag in blog.Tags.Split(',').Take(3))
                                            {
                                                <a href="@Url.Action("Tag", "PublicBlog", new { tag = tag.Trim() })"
                                                   class="blog-tag">@tag.Trim()</a>
                                            }
                                        </div>
                                    }

                                    <!-- Read More Button -->
                                    <a href="@Url.Action("Details", "PublicBlog", new { id = blog.Id, slug = blog.Slug })"
                                       class="blog-read-more">
                                        <span>Devamını Oku</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </article>
                        }
                    </div>

                    <!-- Pagination -->
                    @if (ViewBag.TotalPages > 1)
                    {
                        <nav aria-label="Blog pagination" class="blog-pagination">
                            <ul class="pagination">
                                @if (ViewBag.CurrentPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Index", "PublicBlog", new { page = ViewBag.CurrentPage - 1 })" aria-label="Önceki">
                                            <i class="fas fa-chevron-left"></i>
                                        </a>
                                    </li>
                                }

                                @for (int i = Math.Max(1, ViewBag.CurrentPage - 2); i <= Math.Min((int)ViewBag.TotalPages, ViewBag.CurrentPage + 2); i++)
                                {
                                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                        <a class="page-link" href="@Url.Action("Index", "PublicBlog", new { page = i })">@i</a>
                                    </li>
                                }

                                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                                {
                                    <li class="page-item">
                                        <a class="page-link" href="@Url.Action("Index", "PublicBlog", new { page = ViewBag.CurrentPage + 1 })" aria-label="Sonraki">
                                            <i class="fas fa-chevron-right"></i>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </nav>
                    }
                }
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Modern Search Box -->
                <div class="modern-search-card">
                    <div class="search-header">
                        <i class="fas fa-search search-icon"></i>
                        <h4 class="search-title">Blog Arama</h4>
                    </div>
                    <form action="@Url.Action("Search", "PublicBlog")" method="get" class="modern-search-form">
                        <div class="search-input-wrapper">
                            <input type="text"
                                   name="query"
                                   value="@ViewBag.SearchQuery"
                                   class="modern-search-input"
                                   placeholder="Ne arıyorsunuz?"
                                   autocomplete="off">
                            <button type="submit" class="search-submit-btn">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        <div class="search-suggestions">
                            <span class="suggestion-label">Popüler aramalar:</span>
                            <div class="suggestion-tags">
                                <a href="@Url.Action("Search", "PublicBlog", new { query = "lojistik" })" class="suggestion-tag">Lojistik</a>
                                <a href="@Url.Action("Search", "PublicBlog", new { query = "teknoloji" })" class="suggestion-tag">Teknoloji</a>
                                <a href="@Url.Action("Search", "PublicBlog", new { query = "kargo" })" class="suggestion-tag">Kargo</a>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Recent Posts -->
                <div class="sidebar-card">
                    <h4 class="sidebar-card-title">
                        <i class="fas fa-clock"></i>
                        Son Yazılar
                    </h4>
                    <div class="recent-posts">
                        @{
                            var recentPosts = Model.Take(5);
                        }
                        @foreach (var recentPost in recentPosts)
                        {
                            <div class="recent-post-item">
                                <h6>
                                    <a href="@Url.Action("Details", "PublicBlog", new { id = recentPost.Id, slug = recentPost.Slug })">
                                        @recentPost.Title
                                    </a>
                                </h6>
                                <div class="recent-post-meta">
                                    <i class="far fa-calendar-alt"></i>
                                    <span>@recentPost.PublishDate.ToString("dd MMM yyyy")</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Popular Tags -->
                <div class="sidebar-card">
                    <h4 class="sidebar-card-title">
                        <i class="fas fa-tags"></i>
                        Popüler Etiketler
                    </h4>
                    <div class="tag-cloud">
                        @if (ViewBag.AvailableTags != null)
                        {
                            @foreach (var tag in ((List<object>)ViewBag.AvailableTags).Take(8))
                            {
                                var tagObj = (dynamic)tag;
                                <a href="@Url.Action("Tag", "PublicBlog", new { tag = tagObj.Name })"
                                   class="tag @(ViewBag.CurrentTag?.ToString() == tagObj.Name?.ToString() ? "active" : "")"
                                   title="@tagObj.Count adet yazı">
                                    @tagObj.Name
                                    <span class="tag-count">(@tagObj.Count)</span>
                                </a>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Styles {
    <link href="~/css/blog-header-modern.css" rel="stylesheet" />
    <link href="~/css/blog-cards.css" rel="stylesheet" />
    <link href="~/css/blog-sidebar.css" rel="stylesheet" />
}

<script>
    // Kategori Scroll - Kullanıcı İpuçları ile
    document.addEventListener('DOMContentLoaded', function() {
        const categoryTabs = document.getElementById('categoryTabs');
        const scrollHint = document.getElementById('scrollHint');

        if (categoryTabs) {
            // Scroll olabilir mi kontrol et
            function checkScrollable() {
                const isScrollable = categoryTabs.scrollWidth > categoryTabs.clientWidth;

                if (isScrollable) {
                    categoryTabs.classList.add('has-more');
                    if (scrollHint) {
                        scrollHint.classList.add('show');
                        // 5 saniye sonra ipucunu gizle
                        setTimeout(() => {
                            scrollHint.classList.remove('show');
                        }, 5000);
                    }
                } else {
                    categoryTabs.classList.remove('has-more');
                    if (scrollHint) {
                        scrollHint.classList.remove('show');
                    }
                }
            }

            // İlk kontrol
            setTimeout(checkScrollable, 100);

            // Pencere boyutu değiştiğinde kontrol et
            window.addEventListener('resize', checkScrollable);

            // Aktif tab'e scroll - Sayfa yüklendiğinde
            const activeTab = categoryTabs.querySelector('.category-tab.active');
            if (activeTab) {
                setTimeout(() => {
                    activeTab.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest',
                        inline: 'center'
                    });
                }, 200);
            }

            // Mouse wheel ile yatay scroll
            categoryTabs.addEventListener('wheel', function(e) {
                if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                    e.preventDefault();
                    this.scrollLeft += e.deltaY;

                    // İpucu kullanıldıktan sonra gizle
                    if (scrollHint) {
                        scrollHint.classList.remove('show');
                    }
                }
            }, { passive: false });

            // Touch scroll - Mobil
            let touchStartX = 0;
            let scrollStartX = 0;
            let hasTouched = false;

            categoryTabs.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                scrollStartX = this.scrollLeft;
                hasTouched = true;
            });

            categoryTabs.addEventListener('touchmove', function(e) {
                if (e.touches.length === 1) {
                    const touchX = e.touches[0].clientX;
                    const diff = touchStartX - touchX;
                    this.scrollLeft = scrollStartX + diff;

                    // İpucu kullanıldıktan sonra gizle
                    if (hasTouched && scrollHint) {
                        scrollHint.classList.remove('show');
                    }
                }
            });

            // Mouse enter/leave ile ipucu göster
            categoryTabs.addEventListener('mouseenter', function() {
                const isScrollable = this.scrollWidth > this.clientWidth;
                if (isScrollable && scrollHint && !scrollHint.classList.contains('used')) {
                    scrollHint.classList.add('show');
                }
            });

            categoryTabs.addEventListener('mouseleave', function() {
                if (scrollHint) {
                    scrollHint.classList.remove('show');
                }
            });

            // Scroll kullanıldığında ipucunu kalıcı gizle
            categoryTabs.addEventListener('scroll', function() {
                if (scrollHint) {
                    scrollHint.classList.add('used');
                    scrollHint.classList.remove('show');
                }
            });
        }
    });
</script>