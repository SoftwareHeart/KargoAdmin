@model Blog
@{
    ViewData["Title"] = Model.Title;
    Layout = "_PublicLayout";
}

<!-- Modern Blog Detail Header -->
<section class="blog-detail-hero">
    <div class="blog-hero-background" style="background-image: url('@(!string.IsNullOrEmpty(Model.ImageUrl) ? "/uploads/" + Model.ImageUrl : "/img/blog-no-image.png")')"></div>
    <div class="blog-hero-overlay"></div>
    <div class="container">
        <div class="blog-hero-content">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="blog-breadcrumb-nav">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "PublicBlog")">Blog</a></li>
                    <li class="breadcrumb-item active">@Model.Title</li>
                </ol>
            </nav>

            <!-- Blog Meta -->
            <div class="blog-hero-meta">
                <div class="meta-item">
                    <i class="far fa-calendar-alt"></i>
                    <span>@Model.PublishDate.ToString("dd MMMM yyyy")</span>
                </div>
                <div class="meta-item">
                    <i class="far fa-eye"></i>
                    <span>@Model.ViewCount görüntülenme</span>
                </div>
                <div class="meta-item">
                    <i class="far fa-clock"></i>
                    <span>@((Model.Content.Length / 200) + 1) dk okuma</span>
                </div>
            </div>

            <!-- Blog Title -->
            <h1 class="blog-hero-title">@Model.Title</h1>

            <!-- Author Info -->
            <div class="blog-hero-author">
                <div class="author-avatar">
                    <img src="/img/author-placeholder.jpg" alt="@Model.Author.FirstName @Model.Author.LastName">
                </div>
                <div class="author-info">
                    <span class="author-name">@Model.Author.FirstName @Model.Author.LastName</span>
                    <span class="author-title">İçerik Editörü</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Blog Content Section -->
<section class="blog-detail-content">
    <div class="container">
        <!-- Main Content - Full Width -->
        <div class="row justify-content-center">
            <div class="col-lg-12 col-xl-12">
                <!-- Blog Content Card -->
                <article class="blog-content-card">
                    <!-- Content -->
                    <div class="blog-article-content">
                        @Html.Raw(Model.Content)
                    </div>

                    <!-- Tags Section -->
                    @if (!string.IsNullOrEmpty(Model.Tags))
                    {
                        <div class="blog-tags-section">
                            <h4 class="tags-title">
                                <i class="fas fa-tags"></i>
                                Etiketler
                            </h4>
                            <div class="tags-container">
                                @foreach (var tag in Model.Tags.Split(','))
                                {
                                    <a href="@Url.Action("Tag", "PublicBlog", new { tag = tag.Trim() })"
                                       class="blog-detail-tag">
                                        #@tag.Trim()
                                    </a>
                                }
                            </div>
                        </div>
                    }

                    <!-- Social Share -->
                    <div class="blog-share-section">
                        <h4 class="share-title">
                            <i class="fas fa-share-alt"></i>
                            Bu yazıyı paylaş
                        </h4>
                        <div class="share-buttons">
                            <a href="javascript:void(0)"
                               onclick="shareOnFacebook(); return false;"
                               class="share-btn facebook">
                                <i class="fab fa-facebook-f"></i>
                                <span>Facebook</span>
                            </a>
                            <a href="javascript:void(0)"
                               onclick="shareOnTwitter('@Html.Raw(Html.Encode(Model.Title))'); return false;"
                               class="share-btn twitter">
                                <i class="fab fa-twitter"></i>
                                <span>Twitter</span>
                            </a>
                            <a href="javascript:void(0)"
                               onclick="shareOnLinkedIn('@Html.Raw(Html.Encode(Model.Title))'); return false;"
                               class="share-btn linkedin">
                                <i class="fab fa-linkedin-in"></i>
                                <span>LinkedIn</span>
                            </a>
                            <a href="javascript:void(0)"
                               onclick="copyToClipboard(this); return false;"
                               class="share-btn copy">
                                <i class="fas fa-link"></i>
                                <span>Linki Kopyala</span>
                            </a>
                        </div>
                    </div>
                </article>

                <!-- Navigation -->
                <div class="blog-navigation">
                    <a href="@Url.Action("Index", "PublicBlog")" class="nav-btn back-to-list">
                        <i class="fas fa-arrow-left"></i>
                        <span>Tüm Yazılara Dön</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Modern Related Posts Section - GÜNCEL VERSİYON -->
        @if (ViewBag.RelatedBlogs != null && ((List<Blog>)ViewBag.RelatedBlogs).Any())
        {
            <div class="row mt-5">
                <div class="col-12">
                    <div class="modern-related-section">
                        <!-- Dinamik Başlık -->
                        <div class="section-header">
                            @{
                                string sectionTitle = "Son Yazılar";
                                string sectionIcon = "fas fa-clock";
                                string sectionDescription = "En son yayınlanan yazılarımız";

                                if (ViewBag.RelatedPostsType?.ToString() == "related")
                                {
                                    sectionTitle = "İlgili Yazılar";
                                    sectionIcon = "fas fa-link";
                                    sectionDescription = "Bu konuyla ilgili diğer yazılarımız";
                                }
                                else if (ViewBag.RelatedPostsType?.ToString() == "popular")
                                {
                                    sectionTitle = "Popüler Yazılar";
                                    sectionIcon = "fas fa-fire";
                                    sectionDescription = "En çok okunan yazılarımız";
                                }
                            }

                            <div class="section-title-wrapper">
                                <h2 class="section-title">
                                    <i class="@sectionIcon"></i>
                                    @sectionTitle
                                </h2>
                                <p class="section-subtitle">@sectionDescription</p>
                            </div>
                        </div>

                        <!-- Modern Cards Grid -->
                        <div class="modern-posts-grid">
                            @foreach (var relatedBlog in ((List<Blog>)ViewBag.RelatedBlogs))
                            {
                                <article class="modern-post-card">
                                    <!-- Card Image -->
                                    <div class="card-image-wrapper">
                                        <img src="@(!string.IsNullOrEmpty(relatedBlog.ImageUrl) ? "/uploads/" + relatedBlog.ImageUrl : "/img/blog-no-image.png")"
                                             alt="@relatedBlog.Title"
                                             class="card-image">

                                        <!-- Overlay with Action -->
                                        <div class="image-overlay">
                                            <a href="@Url.Action("Details", "PublicBlog", new { id = relatedBlog.Id, slug = relatedBlog.Slug })"
                                               class="read-action-btn">
                                                <i class="fas fa-arrow-right"></i>
                                            </a>
                                        </div>

                                        <!-- Category Badge -->
                                        @if (!string.IsNullOrEmpty(relatedBlog.Tags))
                                        {
                                            <span class="category-badge">
                                                @relatedBlog.Tags.Split(',').FirstOrDefault()?.Trim()
                                            </span>
                                        }

                                        <!-- Popularity Indicator -->
                                        @if (ViewBag.RelatedPostsType?.ToString() == "popular")
                                        {
                                            <span class="popularity-badge">
                                                <i class="fas fa-fire"></i>
                                                Popüler
                                            </span>
                                        }
                                    </div>

                                    <!-- Card Content -->
                                    <div class="card-content">
                                        <!-- Meta Info -->
                                        <div class="post-meta">
                                            <span class="meta-item">
                                                <i class="far fa-calendar-alt"></i>
                                                @relatedBlog.PublishDate.ToString("dd MMM yyyy")
                                            </span>
                                            <span class="meta-item">
                                                <i class="far fa-eye"></i>
                                                @relatedBlog.ViewCount
                                            </span>
                                        </div>

                                        <!-- Title -->
                                        <h3 class="post-title">
                                            <a href="@Url.Action("Details", "PublicBlog", new { id = relatedBlog.Id, slug = relatedBlog.Slug })">
                                                @relatedBlog.Title
                                            </a>
                                        </h3>

                                        <!-- Excerpt -->
                                        @{
                                            var excerpt = System.Text.RegularExpressions.Regex.Replace(relatedBlog.Content, "<.*?>", "");
                                            excerpt = excerpt.Length > 100 ? excerpt.Substring(0, 100) + "..." : excerpt;
                                        }
                                        <p class="post-excerpt">@excerpt</p>

                                        <!-- Read More -->
                                        <div class="read-more-wrapper">
                                            <a href="@Url.Action("Details", "PublicBlog", new { id = relatedBlog.Id, slug = relatedBlog.Slug })"
                                               class="read-more-link">
                                                Devamını Oku
                                                <i class="fas fa-chevron-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </article>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

@section Styles {
    <link href="~/css/blog-detail.css" rel="stylesheet" />
}

<script>
    // Social Share Functions - Dinamik URL kullanımı
    function getCurrentPageUrl() {
        return window.location.href;
    }

    function getCurrentPageTitle() {
        return document.title;
    }

    function shareOnFacebook() {
        const url = getCurrentPageUrl();
        window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url), '_blank', 'width=600,height=400');
    }

    function shareOnTwitter(title) {
        const url = getCurrentPageUrl();
        const text = title || getCurrentPageTitle();
        window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(text) + '&url=' + encodeURIComponent(url), '_blank', 'width=600,height=400');
    }

    function shareOnLinkedIn(title) {
        const url = getCurrentPageUrl();
        window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(url), '_blank', 'width=600,height=400');
    }

    function copyToClipboard(buttonElement) {
        const url = getCurrentPageUrl();

        navigator.clipboard.writeText(url).then(function() {
            // Show success message
            const btn = buttonElement;
            const originalText = btn.querySelector('span').textContent;
            const originalBg = btn.style.background;

            btn.querySelector('span').textContent = 'Kopyalandı!';
            btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';

            setTimeout(() => {
                btn.querySelector('span').textContent = originalText;
                btn.style.background = originalBg;
            }, 2000);
        }).catch(function(err) {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = url;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                const btn = buttonElement;
                const originalText = btn.querySelector('span').textContent;
                const originalBg = btn.style.background;

                btn.querySelector('span').textContent = 'Kopyalandı!';
                btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';

                setTimeout(() => {
                    btn.querySelector('span').textContent = originalText;
                    btn.style.background = originalBg;
                }, 2000);
            } catch (err) {
                console.error('Kopyalama başarısız:', err);
                alert('Link kopyalanamadı. Lütfen manuel olarak kopyalayın: ' + url);
            }

            document.body.removeChild(textArea);
        });
    }

    // Smooth scroll for internal links
    document.addEventListener('DOMContentLoaded', function() {
        // Internal link scroll
        const links = document.querySelectorAll('a[href^="#"]');
        links.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Reading progress bar (optional)
        const article = document.querySelector('.blog-article-content');
        if (article) {
            const progressBar = document.createElement('div');
            progressBar.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 0%;
                height: 3px;
                background: linear-gradient(90deg, #005cb9, #0066cc);
                z-index: 9999;
                transition: width 0.1s ease;
            `;
            document.body.appendChild(progressBar);

            window.addEventListener('scroll', function() {
                const scrolled = window.pageYOffset;
                const articleTop = article.offsetTop;
                const articleHeight = article.offsetHeight;
                const windowHeight = window.innerHeight;
                const maxScroll = articleTop + articleHeight - windowHeight;

                if (scrolled >= articleTop && scrolled <= maxScroll) {
                    const progress = ((scrolled - articleTop) / (articleHeight - windowHeight)) * 100;
                    progressBar.style.width = Math.min(100, Math.max(0, progress)) + '%';
                } else if (scrolled < articleTop) {
                    progressBar.style.width = '0%';
                } else {
                    progressBar.style.width = '100%';
                }
            });
        }
    });
</script>