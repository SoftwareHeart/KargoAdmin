@using Microsoft.AspNetCore.Identity
@using KargoAdmin.Models
@using KargoAdmin.Services
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject ILanguageService LanguageService
@inject ISettingsService SettingsService

<!DOCTYPE html>
<html lang="@(LanguageService.GetCurrentLanguage())">
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Aleris Global Lojistik</title>
    <link rel="icon" type="image/png" href="~/img/Logo.png" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/poppins-fonts.css" asp-append-version="true" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Sacramento&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/public.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/navbar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/hero.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/animation-section.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/services-section.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/fleet-showcase.css" asp-append-version="true" />
    
        <link rel="stylesheet" href="~/css/footer.css" asp-append-version="true" />
        <link rel="stylesheet" href="~/css/search-modal.css" asp-append-version="true" />
    <!-- Font Awesome CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">

    @await RenderSectionAsync("Styles", required: false)
    <style>
        .language-flags .flag-icon { cursor: pointer; opacity: 0.6; transition: transform 0.15s ease, opacity 0.15s ease, box-shadow 0.15s ease; }
        .language-flags .flag-icon:hover { transform: scale(1.05); opacity: 0.85; }
        .language-flags .flag-icon.active { opacity: 1; box-shadow: 0 0 0 2px #0d6efd inset; cursor: default; pointer-events: none; border-radius: 4px; }
    </style>
</head>
<body>
    @Html.AntiForgeryToken()
    <header>
        <nav class="modern-navbar" id="modernNavbar">
            <div class="navbar-container">
                <!-- Logo -->
                <div class="navbar-logo">
                    <a href="/">
                        <img src="~/img/Logo.png" alt="Aleris Global Lojistik" />
                    </a>
                </div>

                <!-- Menu Items -->
                <div class="navbar-menu" id="navbarMenu">
                    <a href="/" class="nav-item @(ViewContext.RouteData.Values["Action"].ToString() == "Index" && ViewContext.RouteData.Values["Controller"].ToString() == "Public" ? "active" : "")">@(LanguageService.GetCurrentLanguage() == "en" ? "Home" : "Anasayfa")</a>

                    <!-- Hizmetlerimiz Dropdown -->
                    <div class="nav-dropdown">
                        <a href="#" class="nav-item dropdown-toggle @(ViewContext.RouteData.Values["Action"].ToString() == "Services" ? "active" : "")">
                            @(LanguageService.GetCurrentLanguage() == "en" ? "Services" : "Hizmetlerimiz")
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu-custom">
                            <a href="/Aleris/Servisler/KaraYolu" class="dropdown-item-custom">
                                <i class="fas fa-truck"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "Land Transport" : "Kara Yolu Taşımacılığı")
                            </a>
                            <a href="/Aleris/Servisler/HavaYolu" class="dropdown-item-custom">
                                <i class="fas fa-plane"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "Air Transport" : "Hava Yolu Taşımacılığı")
                            </a>
                            <a href="/Aleris/Servisler/DenizYolu" class="dropdown-item-custom">
                                <i class="fas fa-ship"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "Sea Transport" : "Deniz Yolu Taşımacılığı")
                            </a>
                            <a href="/Aleris/Servisler/DepolamaDagitim" class="dropdown-item-custom">
                                <i class="fas fa-warehouse"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "Storage & Distribution" : "Depolama Dağıtım")
                            </a>
                        </div>
                    </div>

                    <!-- Faydalı Bilgiler Dropdown -->
                    <div class="nav-dropdown">
                        <a href="#" class="nav-item dropdown-toggle @(ViewContext.RouteData.Values["Controller"].ToString() == "UsefulInfo" ? "active" : "")">
                            @(LanguageService.GetCurrentLanguage() == "en" ? "Useful Information" : "Faydalı Bilgiler")
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu-custom">
                            <a href="@Url.Action("Index", "UsefulInfo")" class="dropdown-item-custom">
                                <i class="fas fa-info-circle"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "Useful Information" : "Faydalı Bilgiler")
                            </a>
                            <a href="/UsefulInfo/LdmCalculator" class="dropdown-item-custom">
                                <i class="fas fa-calculator"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "LDM Calculator" : "LDM Hesapla")
                            </a>
                            <a href="/UsefulInfo/CbmCalculator" class="dropdown-item-custom">
                                <i class="fas fa-cube"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "CBM Calculator" : "CBM Hesapla")
                            </a>
                            <a href="/UsefulInfo/CwCalculator" class="dropdown-item-custom">
                                <i class="fas fa-plane"></i>
                                @(LanguageService.GetCurrentLanguage() == "en" ? "CW Calculator" : "CW Hesapla")
                            </a>
                        </div>
                    </div>
                    <a href="/Aleris/Hakkımızda" class="nav-item @(ViewContext.RouteData.Values["Action"].ToString() == "About" ? "active" : "")">@(LanguageService.GetCurrentLanguage() == "en" ? "About Us" : "Hakkımızda")</a>
                    <!-- Mobile-only Contact link -->
                    <a href="/Aleris/Iletisim" class="nav-item contact-mobile">@(LanguageService.GetCurrentLanguage() == "en" ? "Contact Us" : "İletişime Geç")</a>
                </div>

                <!-- Right Side - Search & Contact & Language -->
                <div class="navbar-actions">
                    <!-- Search Icon -->
                    <button class="search-btn" data-bs-toggle="modal" data-bs-target="#searchModal">
                        <i class="fas fa-search"></i>
                    </button>

                    <!-- Contact Button -->
                    <a href="/Aleris/Iletisim" class="contact-btn">@(LanguageService.GetCurrentLanguage() == "en" ? "Contact Us" : "İletişime Geç!")</a>

                    <!-- Language Flags -->
                    <div class="language-flags">
                        <img src="~/img/EngIcon.png" alt="English" title="@(LanguageService.GetCurrentLanguage() == "en" ? "English (current)" : "English")" aria-current="@(LanguageService.GetCurrentLanguage() == "en" ? "true" : "false")" aria-disabled="@(LanguageService.GetCurrentLanguage() == "en" ? "true" : "false")" class="flag-icon @(LanguageService.GetCurrentLanguage() == "en" ? "active" : "")" onclick="changeLanguage('en')" />
                        <img src="~/img/TrIcon.png" alt="Türkçe" title="@(LanguageService.GetCurrentLanguage() == "tr" ? "Türkçe (geçerli)" : "Türkçe")" aria-current="@(LanguageService.GetCurrentLanguage() == "tr" ? "true" : "false")" aria-disabled="@(LanguageService.GetCurrentLanguage() == "tr" ? "true" : "false")" class="flag-icon @(LanguageService.GetCurrentLanguage() == "tr" ? "active" : "")" onclick="changeLanguage('tr')" />
                    </div>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-toggle" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Search Modal -->
    <div class="modal fade search-modal" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel">@(LanguageService.GetCurrentLanguage() == "en" ? "Search" : "Arama")</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="searchForm">
                        <label for="searchQuery" class="form-label">@(LanguageService.GetCurrentLanguage() == "en" ? "What would you like to search?" : "Ne aramak istiyorsunuz?")</label>
                        <div class="search-input-group">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="searchQuery" placeholder="@(LanguageService.GetCurrentLanguage() == "en" ? "Search the site..." : "Sitede ara...")">
                        </div>
                        <div class="search-helper">
                            <i class="fas fa-lightbulb me-1"></i>
                            @(LanguageService.GetCurrentLanguage() == "en" ? "Try keywords like 'air cargo', 'sea transport', 'storage'" : "'hava kargo', 'deniz taşımacılığı', 'depolama' gibi anahtar kelimeleri deneyin")
                        </div>
                        <div class="search-chips">
                            <span class="search-chip" onclick="fillAndSearch(this)">@(LanguageService.GetCurrentLanguage() == "en" ? "Air Cargo" : "Hava Kargo")</span>
                            <span class="search-chip" onclick="fillAndSearch(this)">@(LanguageService.GetCurrentLanguage() == "en" ? "Sea Transport" : "Deniz Taşımacılığı")</span>
                            <span class="search-chip" onclick="fillAndSearch(this)">@(LanguageService.GetCurrentLanguage() == "en" ? "Storage" : "Depolama")</span>
                        </div>
                        <div class="search-suggestions" id="searchSuggestions" style="display:none;">
                            <div class="suggestion-group" id="suggestPages" style="display:none;">
                                <div class="suggestion-group-title">@(LanguageService.GetCurrentLanguage() == "en" ? "Pages" : "Sayfalar")</div>
                                <ul class="suggestion-list" id="suggestPagesList"></ul>
                            </div>
                            <div class="suggestion-group" id="suggestUseful" style="display:none;">
                                <div class="suggestion-group-title">@(LanguageService.GetCurrentLanguage() == "en" ? "Useful Info" : "Faydalı Bilgi")</div>
                                <ul class="suggestion-list" id="suggestUsefulList"></ul>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <div class="search-footer">
                        <small class="text-muted">@(LanguageService.GetCurrentLanguage() == "en" ? "Press Enter to search" : "Aramak için Enter'a basın")</small>
                        <div>
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">@(LanguageService.GetCurrentLanguage() == "en" ? "Close" : "Kapat")</button>
                            <button id="searchSubmitBtn" type="button" class="btn btn-primary" onclick="performSearch()">
                        <i class="fas fa-search me-1"></i>
                        @(LanguageService.GetCurrentLanguage() == "en" ? "Search" : "Ara")
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="page-container">
        @RenderBody()
    </main>

    <footer class="modern-footer">

        <!-- Main Footer -->

        <div class="footer-main">

            <div class="footer-container">

                <!-- Logo Section - Top section -->

                <div class="footer-logo-section">

                    <div class="footer-logo">

                        <img src="~/img/Logo.png" alt="Aleris Global Lojistik" />

                    </div>

                </div>



                <!-- Footer Grid - 4 Columns -->

                <div class="footer-grid">

                    <!-- About Us Column -->

                    <div class="footer-column">

                        <h5>@(LanguageService.GetCurrentLanguage() == "en" ? "About Us" : "Hakkımızda")</h5>

                        <ul>

                            <li><a href="/Aleris/Servisler/KaraYolu">@(LanguageService.GetCurrentLanguage() == "en" ? "Land Transport" : "Karayolu Taşımacılığı")</a></li>

                            <li><a href="/Aleris/Servisler/HavaYolu">@(LanguageService.GetCurrentLanguage() == "en" ? "Air Transport" : "Havayolu Taşımacılığı")</a></li>

                            <li><a href="/Aleris/Servisler/DenizYolu">@(LanguageService.GetCurrentLanguage() == "en" ? "Sea Transport" : "Denizyolu Taşımacılığı")</a></li>

                            <li><a href="/Aleris/Servisler/DepolamaDagitim">@(LanguageService.GetCurrentLanguage() == "en" ? "Storage & Distribution" : "Depolama ve Dağıtım")</a></li>


                            <li><a href="/FaydaliBilgiler">@(LanguageService.GetCurrentLanguage() == "en" ? "Useful Information/Blog" : "Faydalı Bilgiler/Blog")</a></li>
                            <li><a href="/Aleris/Hakkımızda">@(LanguageService.GetCurrentLanguage() == "en" ? "About Us" : "Hakkımızda")</a></li>

                        </ul>

                    </div>



                    <!-- Social Media Column -->

                    <div class="footer-column">

                        <h5>@(LanguageService.GetCurrentLanguage() == "en" ? "Social Media" : "Sosyal Medya")</h5>

                        <ul>

                            <li><a href="@(SettingsService.GetValue("LinkedInUrl") ?? "#")" target="_blank" rel="noopener">LinkedIn</a></li>

                            <li><a href="@(SettingsService.GetValue("InstagramUrl") ?? "#")" target="_blank" rel="noopener">Instagram</a></li>

                        </ul>

                    </div>


                    

                </div>



                <!-- Bottom Section - Description and Social Icons -->

                <div class="row">

                    <div class="col-lg-8">

                        <div class="footer-description-section">

                            <p class="footer-description">
                                @(LanguageService.GetCurrentLanguage() == "en" ?
                                    "With years of experience in the global logistics sector, Aleris is a leading logistics service provider offering integrated solutions in road, sea, air and intermodal transportation." :
                                    "Aleris, global lojistik sektöründe yılların deneyimiyle; karayolu, denizyolu, havayolu ve intermodal taşımacılık alanlarında entegre çözümler sunan öncü bir lojistik servis sağlayıcısıdır.")

                            </p>

                        </div>

                    </div>

                    <div class="col-lg-4">

                        <div class="footer-social-section">

                            <div class="footer-social">

                                <a href="@(SettingsService.GetValue("InstagramUrl") ?? "#")" aria-label="Instagram" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>

                                <a href="@(SettingsService.GetValue("LinkedInUrl") ?? "#")" aria-label="LinkedIn" target="_blank" rel="noopener"><i class="fab fa-linkedin-in"></i></a>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </div>



        <!-- Footer Bottom -->

        <div class="footer-bottom">

            <div class="footer-bottom-container">

                <div class="footer-bottom-left">

                </div>

                <div class="footer-copyright">

                    © Aleris Global Lojistik @(LanguageService.GetCurrentLanguage() == "en" ? "All Rights Reserved." : "Tüm Hakları Saklıdır.") @DateTime.Now.Year

                </div>

            </div>

        </div>

    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
            (function() {
            let lastScrollTop = 0;
            let scrollDirection = 'up';
            let isScrolling = false;

            // Navbar scroll effect with hide/show functionality
            window.addEventListener('scroll', function() {
                if (isScrolling) return;

                isScrolling = true;

                requestAnimationFrame(function() {
                    const navbar = document.getElementById('modernNavbar');
                    const currentScroll = window.scrollY || document.documentElement.scrollTop;

                    // Scroll direction detection
                    if (currentScroll > lastScrollTop && currentScroll > 100) {
                        // Scrolling down & not near top
                        scrollDirection = 'down';
                        navbar.classList.add('navbar-hidden');
                        navbar.classList.remove('navbar-visible');
                    } else {
                        // Scrolling up OR near top
                        scrollDirection = 'up';
                        navbar.classList.remove('navbar-hidden');
                        navbar.classList.add('navbar-visible');
                    }

                    // Background transparency effect
                    if (currentScroll > 50) {
                        navbar.classList.add('scrolled');
                    } else {
                        navbar.classList.remove('scrolled');
                    }

                    lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
                    isScrolling = false;
                });
            }, { passive: true });

            // Initial state
            document.getElementById('modernNavbar').classList.add('navbar-visible');
        })();
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('navbarMenu');
            menu.classList.toggle('show');
        }

        // Language change function
        function changeLanguage(lang) {
            try {
                var currentLang = '@(LanguageService.GetCurrentLanguage())';
                if (!lang || lang === currentLang) {
                    return; // aynı dile tekrar tıklanmasın
                }
            } catch { /* ignore */ }
            // AJAX ile dil değiştirme
            fetch('/Language/ChangeLanguage', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: 'language=' + lang + '&returnUrl=' + encodeURIComponent(window.location.pathname + window.location.search)
            })
            .then(response => {
                if (response.ok) {
                    window.location.reload();
                }
            })
            .catch(error => {
                console.error('Dil değiştirme hatası:', error);
            });
        }

        // Search function
        function performSearch() {
            const query = document.getElementById('searchQuery').value;
            if (query.trim()) {
                const modal = bootstrap.Modal.getInstance(document.getElementById('searchModal'));
                if (modal) modal.hide();
                window.location.href = '/Search?q=' + encodeURIComponent(query);
            }
        }

        // Enter tuşu ile arama + modal açıldığında input'a odaklanma + butonda loading efekti
        const searchInputEl = document.getElementById('searchQuery');
        const searchSubmitBtn = document.getElementById('searchSubmitBtn');
        document.getElementById('searchModal').addEventListener('shown.bs.modal', function () {
            setTimeout(() => searchInputEl?.focus(), 150);
        });
        searchInputEl.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                performSearch();
            }
        });

        // Fill from chip and search
        function fillAndSearch(el) {
            const val = el.textContent.trim();
            document.getElementById('searchQuery').value = val;
            performSearch();
        }

        // Suggestions (debounced)
        let suggestTimer = null;
        const suggestionsRoot = document.getElementById('searchSuggestions');
        const pagesList = document.getElementById('suggestPagesList');
        const usefulList = document.getElementById('suggestUsefulList');
        const groupPages = document.getElementById('suggestPages');
        const groupUseful = document.getElementById('suggestUseful');

        searchInputEl.addEventListener('input', function () {
            const q = this.value.trim();
            clearTimeout(suggestTimer);
            if (q.length < 2) {
                suggestionsRoot.style.display = 'none';
                return;
            }
            suggestTimer = setTimeout(async () => {
                try {
                    const res = await fetch('/Search/Suggest?q=' + encodeURIComponent(q));
                    const data = await res.json();

                    // Fill lists
                    function fillList(listEl, items) {
                        listEl.innerHTML = '';
                        items.forEach(i => {
                            const li = document.createElement('li');
                            li.className = 'suggestion-item';
                            li.innerHTML = `<a href="${i.url}">${i.title}</a>`;
                            listEl.appendChild(li);
                        });
                    }
                    fillList(pagesList, data.pages || []);
                    fillList(usefulList, data.useful || []);

                    groupPages.style.display = (data.pages && data.pages.length) ? '' : 'none';
                    groupUseful.style.display = (data.useful && data.useful.length) ? '' : 'none';

                    const hasAny = (data.pages && data.pages.length) || (data.useful && data.useful.length);
                    suggestionsRoot.style.display = hasAny ? '' : 'none';
                } catch { suggestionsRoot.style.display = 'none'; }
            }, 250);
        });

        // Mobile menu dışına tıklayınca kapat
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('navbarMenu');
            const toggle = document.querySelector('.mobile-toggle');

            if (!menu.contains(e.target) && !toggle.contains(e.target)) {
                menu.classList.remove('show');
            }
        });

        // Dropdown'a tıklandığında da açılması için (mobile için)
        document.querySelector('.dropdown-toggle').addEventListener('click', function(e) {
            e.preventDefault();
            // Mobile'da dropdown toggle için ek işlevsellik eklenebilir
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>